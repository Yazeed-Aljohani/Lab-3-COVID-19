[
  {
    "objectID": "lab-3.html",
    "href": "lab-3.html",
    "title": "Lab 03: COVID-19 Data Wrangling and Visualization",
    "section": "",
    "text": "Question 1: Public Data\nTake a moment to reflect on the value of open data: How does easy access to historical and real-time environmental data shape our understanding of climate trends, resource management, and public health? What happens when this data disappears or becomes inaccessible? The role of independent archiving and collaborative stewardship has never been more critical in ensuring scientific progress and accountability.\nOpen access to environmental and health data plays a crucial role in helping researchers, policymakers, and the public make informed decisions. Real-time and historical data offer valuable insights into climate trends, resource management, and public health. When this information disappears, transparency and trust are lost, and collaboration between scientists becomes more difficult. Without reliable data, it is harder to track long-term environmental changes or assess the effectiveness of policies. Thankfully, journalists, researchers, and scientists work to archive and protect these records. Platforms like The Internet Archive and Data Refuge help ensure that vital datasets remain available for future use. The New York Times COVID-19 data repository is a prime example of why independent data preservation matters. Its county-level records have been crucial for tracking the pandemic and informing public health responses. Maintaining open access to data is essential for scientific progress and accountability. Efforts to preserve information will support future research and responsible decision-making.\n\n\nQuestion 2: Daily Summary\n\n# 1- Reading in the data\n\ndata &lt;- read_csv('https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv')\n\nRows: 2502832 Columns: 6\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (3): county, state, fips\ndbl  (2): cases, deaths\ndate (1): date\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n\nData Description:\nThe dataset contains 2,502,832 rows and 6 columns, recording COVID-19 case data at the county level across the U.S.\n\nColumns:\n\ndate – The date of the recorded data.\ncounty – The name of the county.\nstate – The state where the county is located.\nfips – A 5-digit code identifying each county (first 2 digits = state, last 3 = county).\ncases – The total number of confirmed cases (cumulative).\ndeaths – The total number of reported deaths (cumulative).\nCreate an object called my.date and set it as “2022-02-01” - ensure this is a date object:. Create a object called my.state and set it to “Colorado”.\n\n\n# 2- Defining Date and State Variables\n\nmy.date &lt;- as.Date(\"2022-02-01\")\nmy.state &lt;- \"Colorado\"\n\n\nThe URL based data read from Github is considered our “raw data”. Remember to always leave “raw-data-raw” and to generate meaningful subsets as you go.\n\n\n# 3- Filtering for Colorado and Compute New Cases\ncolorado &lt;- data |&gt;\nfilter(state == my.state) |&gt;\ngroup_by(county) |&gt;\narrange(date) |&gt;\nmutate(new_cases = cases - lag(cases),\nnew_deaths = deaths - lag(deaths)) |&gt;\nungroup()\n\n\nUsing your subset, generate (2) tables. The first should show the 5 counties with the most CUMULATIVE cases, and the second should show the 5 counties with the most NEW cases. Remember to use your my.date object as a proxy for today’s date:\n\n\n# 4- Finding the 5 Counties with the Most Cumulative Cases\nfilter (colorado, date == my.date) |&gt;\n\nslice_max(cases, n = 5) |&gt;\n\nselect(Date = date, County = county, Cases = cases) |&gt;\n\nflextable() |&gt;\n\nadd_header_lines(\"Most Cumulative Cases\")\n\nMost Cumulative CasesDateCountyCases2022-02-01El Paso170,6732022-02-01Denver159,0222022-02-01Arapahoe144,2552022-02-01Adams126,7682022-02-01Jefferson113,240\n\n\nThe table shows the five Colorado counties with the highest cumulative COVID-19 cases as of February 1, 2022. El Paso, Denver, Arapahoe, Adams, and Jefferson had the most confirmed cases\n\n# 4- Finding the 5 Counties with the Most New Cases\n\nfilter(colorado, date == my.date) |&gt;\nslice_max(cases, n = 5) |&gt;\nselect(Date = date, County = county, Cases = new_cases) |&gt;\nflextable() |&gt;\nadd_header_lines(\"Most New Cases\")\n\nMost New CasesDateCountyCases2022-02-01El Paso6302022-02-01Denver3892022-02-01Arapahoe4012022-02-01Adams3262022-02-01Jefferson291\n\n\nThe table displays the five Colorado counties with the highest new COVID-19 cases on February 1, 2022. El Paso, Denver, Arapahoe, Adams, and Jefferson reported the most new infections, indicating higher transmission rates in these areas on that date.\n\n\n\nQuestion 3: Normalizing Data\n\n# Define the URL\npop_url &lt;- 'https://www2.census.gov/programs-surveys/popest/datasets/2020-2023/counties/totals/co-est2023-alldata.csv'\n\n# Read the population data\npop &lt;- read.csv(pop_url)\n\n\nGiven the above URL, and guidelines on string concatenation and formatting, read in the population data and (1) create a five digit FIP variable and only keep columns that contain “NAME” or “2021” (remember the tidyselect option found with ?dplyr::select). Additionally, remove all state level rows (e.g. COUNTY FIP == “000”)\n\n\n# 1- filtering, and processing the data\npop &lt;- read.csv(pop_url) |&gt;\nfilter(COUNTY != 0) |&gt;\nmutate(fips = paste0(sprintf(\"%02d\", STATE), sprintf(\"%03d\", COUNTY))) |&gt;\nselect(fips, contains('NAME'), contains('2021'))\n\n\nNow, explore the data … what attributes does it have, what are the names of the columns? Do any match the COVID data we have? What are the dimensions… In a few sentences describe the data obtained after modification:\n\nThe dataset has 3,195 rows and 67 columns, providing county-level population estimates from the U.S. Census Bureau.\n\nKey Details:\n\nGeography: It includes state and county names (STNAME, CTYNAME) and FIPS codes for identification.\nPopulation Estimates: Covers 2020-2023 (POPESTIMATE2020-2023).\nBirths & Deaths: Tracks annual births, deaths, and natural population changes.\nMigration: Includes domestic and international migration numbers per county.\nGrowth Trends: Shows yearly population changes.\n\n\n\nHow It Relates to COVID-19 Data:\n\nBoth datasets use FIPS codes, so they can be merged.\nPopulation estimates help normalize COVID-19 data (cases per capita).\nAnnual data means we’ll use 2021 estimates for normalization.\n\n\nWhat is the range of populations seen in Colorado counties in 2021:\n\n\nrange(filter(pop, STNAME == \"Colorado\")$POPESTIMATE2021, na.rm = TRUE)\n\n[1]    741 737287\n\n\nThe result [1] 741 737287 represents the range of populations seen in Colorado counties in 2021:\n\n741 – The smallest county population in Colorado in 2021.\n737287 – The largest county population in Colorado in 2021\nJoin the population data to the Colorado COVID data and compute the per capita cumulative cases, per capita new cases, and per capita new deaths:\n\n\n# Merging COVID and population data\n\nperCap &lt;- inner_join(\n  colorado, \n  select(pop, fips, pop = POPESTIMATE2021), \n  by = \"fips\"\n) |&gt;\n  filter(date == my.date) |&gt;\n  mutate(\n    cumPerCap = cases / pop,\n    newCasesPerCap = new_cases / pop,\n    newDeathsPerCap = new_deaths / pop\n  )\n\n\nGenerate (2) new tables. The first should show the 5 counties with the most cumulative cases per capita on 2021-01-01, and the second should show the 5 counties with the most NEW cases per capita on the same date. Your tables should have clear column names and descriptive captions.\n\n\n# 5- Top 5 Counties by Cumulative Cases per Capita\n\nperCap |&gt;\nselect(County = county, Cases = cumPerCap) |&gt;\nslice_max(Cases, n = 5) |&gt;\nflextable() |&gt;\nadd_header_lines(\"Most Cummulitive Cases Per Capita\")\n\nMost Cummulitive Cases Per CapitaCountyCasesCrowley0.5117698Bent0.4118749Pitkin0.3429659Lincoln0.3424082Logan0.3047701\n\n\nThe table ranks Colorado counties with the highest cumulative COVID-19 cases per capita as of February 1, 2022. Crowley, Bent, Pitkin, Lincoln, and Logan counties had the most infections relative to their populations\n\n# 5- Top 5 Counties by New Cases per Capitav\nperCap |&gt;\nselect(County = county, Cases = newCasesPerCap) |&gt;\nslice_max(Cases, n = 5) |&gt;\nflextable() |&gt;\nadd_header_lines(\"Most New Cases Per Capita\")\n\nMost New Cases Per CapitaCountyCasesCrowley0.009764603Bent0.004120622Sedgwick0.003869304Washington0.002875924Las Animas0.002651039\n\n\nThe table ranks Colorado counties with the highest new COVID-19 cases per capita on JFebruary 1, 2021. Crowley, Bent, Sedgwick, Washington, and Las Animas counties had the most new infections relative to their populations\n\n\n\nQuestion 4: Rolling thresholds\nFilter the merged COVID/Population data to only include the last 14 days. Remember this should be a programmatic request and not hard-coded. Then, use the group_by/summarize paradigm to determine the total number of new cases in the last 14 days per 100,000 people. Print a table of the top 5 counties, and, report the number that meet the watch list condition: “More than 100 new cases per 100,000 residents over the past 14 days…”\n\nsafe &lt;- pop |&gt;\ninner_join(colorado, by = \"fips\") |&gt;\nfilter(between(date, my.date - 13, my.date)) |&gt;\ngroup_by(county) |&gt;\nsummarize(lag = sum(new_cases) / (POPESTIMATE2021[1]/100000)) |&gt;\nungroup()\n\n\nsafe |&gt;\nselect(County = county, Cases = lag) |&gt;\nslice_max(Cases, n = 10) |&gt;\nflextable() |&gt;\nadd_header_lines(\"Cases per 100,000 in the last 14 days\")\n\nCases per 100,000 in the last 14 daysCountyCasesCrowley3,923.278Lincoln3,599.488Alamosa3,594.909Mineral3,336.921Conejos3,152.203Fremont3,097.264Huerfano2,682.434Bent2,659.674Montezuma2,649.234Mesa2,573.695\n\n\nThe table ranks Colorado counties with the highest COVID-19 cases per 100,000 residents in the last 14 days before February 1, 2022. Crowley, Lincoln, and Alamosa counties had the highest infection rates.\n\n\nQuestion 5: Death toll\nGiven we are assuming it is February 1st, 2022. Your leadership has asked you to determine what percentage of deaths in each county were attributed to COVID last year (2021). You eagerly tell them that with the current Census data, you can do this!\nFrom previous questions you should have a data.frame with daily COVID deaths in Colorado and the Census based, 2021 total deaths. For this question, you will find the ratio of total COVID deaths per county (2021) of all recorded deaths. In a plot of your choosing, visualize all counties where COVID deaths account for 20% or more of the annual death toll.\n\nx &lt;- colorado |&gt;\nmutate(year = lubridate :: year(date)) |&gt;\nfilter(year == 2021) |&gt;\ngroup_by(fips) |&gt;\nsummarize(deaths = sum(new_deaths, na.rm = TRUE)) |&gt;\nleft_join(pop, by = c(\"fips\")) |&gt;\nmutate(death_ratio = 100 * (deaths / DEATHS2021)) |&gt;\nselect(CTYNAME, deaths, DEATHS2021, death_ratio) |&gt;\nfilter(death_ratio &gt; 20)\n\n\nggplot(x, aes(x = death_ratio, y = reorder(CTYNAME, death_ratio))) +\n  geom_col(fill = \"red\") +  \n  theme_light() +\n  labs(\n    title = \"Counties Where COVID Deaths Were &gt;20% of Total Deaths (2021)\",\n    x = \"COVID-19 Death Percentage (%)\",\n    y = \"County\"\n  )\n\n\n\n\n\n\n\n\nThe bar chart displays Colorado counties where COVID-19 deaths accounted for more than 20% of total deaths in 2021. Conejos, Bent, and San Miguel counties had the highest percentages, exceeding 30-40%.\n\n\nQuestion 6: Multi-state\nIn this question, we are going to look at the story of 4 states and the impact scale can have on data interpretation. The states include: New York, Colorado, Alabama, and Ohio. Your task is to make a faceted bar plot showing the number of daily, new cases at the state level.\n\nFirst, we need to group/summarize our county level data to the state level, filter it to the four states of interest, and calculate the number of daily new cases (diff/lag) and the 7-day rolling mean.\n\nlibrary(tidyverse)\nlibrary(zoo)\n\nstate_covid &lt;- data |&gt;\n  filter(state %in% c(\"New York\", \"Ohio\", \"Colorado\", \"Alabama\")) |&gt;  \n  group_by(date, state) |&gt;\n   summarise(cases = sum(cases, na.rm = TRUE), .groups = \"drop\") |&gt;  \n  arrange(state, date) |&gt;  \n  group_by(state) |&gt;  \n  mutate(\n    newCases = cases - lag(cases, default = 0), \n    roll = zoo::rollmean(newCases, k = 7, align = \"right\", fill = NA)  \n  ) |&gt;\n  ungroup()\n\nUsing the modified data, make a facet plot of the daily new cases and the 7-day rolling mean. Your plot should use compelling geoms, labels, colors, and themes.\n\n\nlibrary(ggplot2)\n\nggplot(state_covid, aes(x = date)) +\n  geom_col(aes(y = newCases), fill = \"lightblue\", col = \"purple\") +  \n  geom_line(aes(y = roll), color = \"darkblue\", size = 1) +  \n  theme_linedraw() +  \n  facet_wrap(~state, nrow = 2, scales = \"free_y\") +   \n  labs(\n    title = \"Cumulative COVID-19 Cases\",\n    x = \"Date\",\n    y = \"Case Count\"\n  )\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n\n\nWarning: Removed 6 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\n\n\n\n\n\n\n\nThe facted plot displays daily new COVID-19 cases and 7-day rolling averages for Alabama, Colorado, New York, and Ohio. Peaks in cases align with major COVID-19 waves, showing significant surges in late 2020 and early 2022, with New York experiencing the highest spikes.\n\nThe story of raw case counts can be misleading. To understand why, lets explore the cases per capita of each state. To do this, join the state COVID data to the population estimates and calculate the newcases/totalpopulation. Additionally, calculate the 7-day rolling mean of the new cases per capita counts. This is a tricky task and will take some thought, time, and modification to existing code (most likely)!\n\n\nlibrary(tidyverse)\nlibrary(zoo)\n\nstate_pop &lt;- pop |&gt;\n  group_by(STNAME) |&gt;\n  summarise(state_pop = sum(POPESTIMATE2021, na.rm = TRUE))  \n\nstate_covid_per_capita &lt;- state_covid |&gt;\n  inner_join(state_pop, by = c(\"state\" = \"STNAME\")) |&gt;  \n  mutate(\n    perCap = newCases / state_pop,  \n    roll = zoo::rollmean(perCap, k = 7, align = \"right\", fill = NA)  \n  ) |&gt;\n  ungroup()\n\n\nlibrary(ggplot2)\n\n# Plot the 7-day rolling average per capita\nggplot(state_covid_per_capita, aes(x = date, y = roll, color = state)) +\n  geom_line(size = 1.2) +  # Line graph for rolling average\n  theme_linedraw() +  # Better grid theme\n  labs(\n    title = \"COVID-19 Cases Per Capita (7-Day Rolling Average)\",\n    subtitle = \"Comparing New York, Ohio, Colorado, and Alabama\",\n    x = \"Date\",\n    y = \"Cases Per 100,000 People\",\n    color = \"State\"\n  ) +\n  scale_color_manual(values = c(\"New York\" = \"blue\", \"Ohio\" = \"purple\", \n                                \"Colorado\" = \"red\", \"Alabama\" = \"green\")) +\n  theme(\n    text = element_text(size = 14),\n    plot.title = element_text(face = \"bold\", hjust = 0.5),\n    legend.position = \"top\"\n  )\n\nWarning: Removed 6 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\n\n\n\n\n\n\n\nThe graph shows the 7-day rolling average of COVID-19 cases per 100,000 people for New York, Ohio, Colorado, and Alabama. Major surges occurred in late 2020 and early 2022, with New York peaking highest.\n\nBriefly describe the influence scaling by population had on the analysis? Does it make some states look better? Some worse? How so?\n\nScaling by population allows for a fair comparison of COVID-19 severity across states. Initially, New York appeared worst due to its high total cases, while smaller states seemed less affected. After adjusting per capita, Alabama and Colorado showed comparable or even higher infection rates, revealing that outbreaks were more intense relative to their population sizes. This adjustment prevents misleading conclusions and highlights hidden trends in smaller states, making the analysis more accurate.\n\n\nQuestion 7: Space & Time\n\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(maps)\n\nWarning: package 'maps' was built under R version 4.4.3\n\n\n\nAttaching package: 'maps'\n\n\nThe following object is masked from 'package:purrr':\n\n    map\n\ncovid_geo &lt;- read_csv('https://raw.githubusercontent.com/mikejohnson51/csu-ess-330/refs/heads/main/resources/county-centroids.csv') |&gt;\n  inner_join(data, by = \"fips\") \n\nRows: 3221 Columns: 3\n\n\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (1): fips\ndbl (2): LON, LAT\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\nmeta &lt;- covid_geo |&gt;\n  group_by(date) |&gt;\n  summarise(\n    wmX_c = sum(LON * cases, na.rm = TRUE) / sum(cases, na.rm = TRUE),  \n    wmY_c = sum(LAT * cases, na.rm = TRUE) / sum(cases, na.rm = TRUE),  \n    cases = sum(cases, na.rm = TRUE)  \n  ) |&gt;\n  arrange(date) |&gt;\n  mutate(d = row_number())  \n\n\nggplot(meta) +\n  borders(\"state\", fill = \"gray90\", colour = \"white\") +  \n  geom_point(aes(x = wmX_c, y = wmY_c, size = cases), color = \"red\", alpha = 0.5) +  \n  theme_linedraw() +\n  labs(\n    color = \"Time\",\n    size = \"Total Cases\",\n    x = \"Longitude\",\n    y = \"Latitude\",\n    title = \"Weighted Center of COVID-19 Cases in the USA\"\n  ) +\n  theme(legend.position = \"right\")  \n\n\n\n\n\n\n\n\nThe COVID-19 weighted mean center was initially concentrated in the Northeast, where early outbreaks in New York and New Jersey fueled a surge in cases. Over time, it gradually shifted west and south, reflecting the spread of the virus into the Midwest and Southern states. This movement was influenced by population density, travel patterns, and changing public health policies. As the pandemic evolved, major waves like Delta and Omicron caused rapid shifts, highlighting how different regions experienced surges at different times.\n\n\nQuestion 8: Cases vs. Deaths\n\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(patchwork)\n\n\nmeta &lt;- read_csv('https://raw.githubusercontent.com/mikejohnson51/csu-ess-330/refs/heads/main/resources/county-centroids.csv') %&gt;%\n  inner_join(data, by = \"fips\") %&gt;%\n  group_by(date) %&gt;%\n  summarise(\n    wmx_c = sum(LON * cases, na.rm = TRUE) / sum(cases, na.rm = TRUE),  \n    WMY_c = sum(LAT * cases, na.rm = TRUE) / sum(cases, na.rm = TRUE),  \n    cases = sum(cases, na.rm = TRUE),  \n    wmx_d = sum(LON * deaths, na.rm = TRUE) / sum(deaths, na.rm = TRUE),  \n    WMY_d = sum(LAT * deaths, na.rm = TRUE) / sum(deaths, na.rm = TRUE), \n    deaths = sum(deaths, na.rm = TRUE)  \n  ) %&gt;%\n  arrange(date) %&gt;%\n  mutate(d = row_number())  \n\nRows: 3221 Columns: 3\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (1): fips\ndbl (2): LON, LAT\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\np1 &lt;- ggplot(meta) +\n  borders(\"state\", fill = \"gray98\", colour = \"white\") +\n  geom_point(aes(x = wmx_c, y = WMY_c, size = cases), color = \"red\", alpha = 0.25) +\n  theme_linedraw() +\n  labs(\n    color = \"Time\",\n    size = \"Cases\",\n    x = \"\",\n    y = \"\",\n    title = \"Weighted Center of COVID-19 Cases\"\n  ) +\n  theme(legend.position = \"right\")\n\np2 &lt;- ggplot(meta) +\n  borders(\"state\", fill = \"gray98\", colour = \"white\") +\n  geom_point(aes(x = wmx_d, y = WMY_d, size = deaths), color = \"navy\", alpha = 0.25) +\n  theme_linedraw() +\n  labs(\n    color = \"Time\",\n    size = \"Deaths\",\n    x = \"\",\n    y = \"\",\n    title = \"Weighted Center of COVID-19 Deaths\"\n  ) +\n  theme(legend.position = \"right\")\n\n\np1 + p2\n\nWarning: Removed 39 rows containing missing values or values outside the scale range\n(`geom_point()`)."
  }
]